{"version":3,"sources":["welcomeHeader.svg","configuration.js","components/MailboxCard.js","components/MemberCard.js","components/MembersTable.js","App.js","index.js"],"names":["apiServer","memberKeys","memberTableColumns","formatDate","str","date","Date","getDate","toString","padStart","getMonth","getFullYear","formatting","cleanMailboxName","name","trim","toLowerCase","replace","MailboxCard","props","useState","welcomeHeaderTemplate","setWelcomeHeaderTemplate","mailboxName","setMailboxName","forceShow","setForceShow","useEffect","console","log","welcomeHeaderFile","fetch","then","res","text","data","Object","keys","memberData","length","renderCanvas","username","a","canvas","document","querySelector","ctx","getContext","Canvg","fromString","start","register","window","confirm","toBlob","blob","formData","FormData","append","id","method","body","status","members","membersCopy","index","findIndex","member","registered","setMembers","updateMemberData","alert","href","onClick","event","preventDefault","setTimeout","focus","style","display","htmlFor","value","autoFocus","autoComplete","spellCheck","type","onKeyUp","key","click","onChange","target","MemberCard","map","memberDataKey","className","MembersTable","handleKeyPress","useCallback","setMemberData","addEventListener","removeEventListener","column","join","selectMember","App","json","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.caaef049.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/welcomeHeader.6158d06b.svg\";","export const apiServer = 'https://koira.testausserveri.fi';\r\n\r\nexport const memberKeys = {\r\n    \"id\": \"ID\",\r\n    \"username\": \"Käyttäjänimi\",\r\n    \"registered\": \"Postilaatikko\",\r\n    \"joinedTimestamp\": \"Liittynyt\",\r\n    \"createdAt\": \"Luotu\"\r\n};\r\nexport const memberTableColumns = [\r\n    \"id\",\r\n    \"createdAt\",\r\n    \"username\",\r\n    \"registered\"\r\n];\r\n\r\nfunction formatDate(str) {\r\n    const date = new Date(str);\r\n    return `${(date.getDate()).toString().padStart(2, '0')}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getFullYear()}`\r\n}\r\nexport const formatting = {\r\n    \"createdAt\": formatDate,\r\n    \"joinedTimestamp\": formatDate\r\n}","import Canvg from 'canvg';\r\nimport { useState, useEffect } from 'react';\r\nimport welcomeHeaderFile from '../welcomeHeader.svg';\r\nimport { apiServer } from '../configuration';\r\n\r\nfunction cleanMailboxName(name) {\r\n    return name.trim().toLowerCase().replace(/ /g, '.').replace(/ä/g, 'a').replace(/ö/g, 'o').replace(/[^0-9a-zA-Z.]/g, '');\r\n}\r\n\r\nfunction MailboxCard(props) {\r\n    const [ welcomeHeaderTemplate, setWelcomeHeaderTemplate ] = useState('');\r\n    const [ mailboxName, setMailboxName ] = useState('');\r\n    const [ forceShow, setForceShow ] = useState(false);\r\n\r\n    useEffect(() => {\r\n        console.log('Fetching welcomeHeader from ' + welcomeHeaderFile + '...');\r\n        fetch(welcomeHeaderFile)\r\n        .then(res => res.text())\r\n        .then(data => {\r\n            setWelcomeHeaderTemplate(data);\r\n        })\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        setForceShow(false);\r\n        if (Object.keys(props.memberData).length > 0) {\r\n            renderCanvas(props.memberData.username);     \r\n        }\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [props.memberData])\r\n\r\n    const renderCanvas = async (username) => {\r\n        console.log('Rendering canvas...')\r\n        const name = cleanMailboxName(username);\r\n        setMailboxName(name);\r\n\r\n        const canvas = document.querySelector('canvas');\r\n        const ctx = canvas.getContext('2d');\r\n        const v = await Canvg.fromString(ctx, welcomeHeaderTemplate.replace('[name]', name).replace('[size]', (name.length > 13 ? '0.7em' : '1em')));\r\n\r\n        v.start();\r\n    }\r\n\r\n    const update = (name) => {\r\n        renderCanvas(name);    \r\n    }\r\n\r\n    const updateMemberData = () => {\r\n        console.log(props.members)\r\n        const membersCopy = [...props.members];\r\n        const index = membersCopy.findIndex(member => member.id === props.memberData.id)\r\n        membersCopy[index].registered = mailboxName;\r\n        props.setMembers(membersCopy);\r\n    }\r\n\r\n    const inputKeyUpEvent = (event) => {\r\n        if(event.key !== \"Enter\") return; \r\n        document.querySelector(\"#registerBtn\").click(); \r\n        event.preventDefault(); \r\n    };\r\n\r\n    const register = () => {\r\n        if (window.confirm(`Myönnät käyttäjälle ${props.memberData.username} sähköpostilaatikon ${mailboxName}@testausserveri.fi ja lähetät kyseiselle käyttäjälle Discord-viestin tästä jäsenedusta. Vahvista?`)) {\r\n            document.querySelector('canvas').toBlob(function(blob) {\r\n                const formData = new FormData();\r\n                formData.append('image', blob, mailboxName + '.png');\r\n                formData.append('id', props.memberData.id);\r\n                formData.append('mailbox', mailboxName);\r\n                fetch(apiServer + '/api/sendWelcome', {\r\n                    method: 'POST',\r\n                    body: formData\r\n                })\r\n                .then(res => {\r\n                    console.log(res)\r\n                    if (res.status === 200) {\r\n                        setForceShow(false);\r\n                        updateMemberData();\r\n                    } else {\r\n                        alert('Tapahtui jokin virhe. Älä myönnä käyttäjälle uutta sähköpostilaatikkoa. Ota yhteyttä järjestelmänvalvojaa.');\r\n                    }\r\n                })\r\n            });\r\n    \r\n        } else {\r\n            alert('Peruutettu');\r\n        }\r\n    }\r\n    return (\r\n        <div>\r\n            {(props.memberData.registered ? \r\n            <p>\r\n                <b>\r\n                    Jäsenellä on jo sähköpostilaatikko.&nbsp;\r\n                    <a href=\"#forceShow\" onClick={(event) => {event.preventDefault(); setForceShow(true); setTimeout(()=>{document.querySelector('#memberEmailInput').focus();}, 5)}}>Luo alias</a>\r\n                </b>\r\n            </p> \r\n            : \r\n            <p>\r\n                Jäsenellä ei ole vielä sähköpostilaatikkoa.\r\n            </p>\r\n            )}\r\n            <div style={(!!!props.memberData.registered || forceShow) ? {} : {display: 'none'}}>\r\n                <label htmlFor=\"memberEmailInput\">Sähköpostilaatikon nimi</label><br></br>\r\n                <input id=\"memberEmailInput\" value={mailboxName} autoFocus={true} autoComplete=\"off\" spellCheck=\"false\" type=\"text\" onKeyUp={inputKeyUpEvent} onChange={(event) => update(event.target.value)} />\r\n                <canvas></canvas><br /><br />\r\n                <input type=\"button\" id=\"registerBtn\" value=\"Rekisteröi ja lähetä viesti\" onClick={() => register()}/>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default MailboxCard;","import { memberKeys, formatting } from '../configuration';\r\n\r\nfunction MemberCard(props) {\r\n    return (\r\n        <table>\r\n            <tbody>\r\n                {Object.keys(props.memberData).map(memberDataKey => {\r\n                    return (\r\n                        <tr key={memberDataKey} className=\"memberCard\">\r\n                            <td>{memberKeys[memberDataKey] || memberDataKey}</td>\r\n                            <td>{formatting[memberDataKey] ? formatting[memberDataKey](props.memberData[memberDataKey]) : props.memberData[memberDataKey]}</td>\r\n                        </tr>\r\n                    )\r\n                })}\r\n            </tbody>\r\n        </table>\r\n    )\r\n}\r\n\r\nexport default MemberCard;","import { useCallback, useEffect } from 'react';\r\nimport {memberTableColumns, memberKeys, formatting} from '../configuration';\r\nfunction MembersTable(props) {\r\n    const handleKeyPress = useCallback(event => {\r\n        const key = event.key; \r\n        \r\n        if (key === 'ArrowUp' || key === 'ArrowDown') {\r\n            let index = props.members.findIndex(member => member.id === props.memberData.id);\r\n            console.log(props.members)\r\n            if (key === 'ArrowUp') {\r\n                index -= 1;\r\n                if (index <= 0) index = 0;\r\n            } else if (key === 'ArrowDown') {\r\n                index += 1;\r\n                if (index >= props.members.length - 1) index = props.members.length - 1;\r\n            }\r\n            console.log(index, props.members[index])\r\n            if (props.members[index]) {\r\n                props.setMemberData(props.members[index]);\r\n            }\r\n        }\r\n    }, [props]);\r\n\r\n    useEffect(() => {\r\n        window.addEventListener('keydown', handleKeyPress);\r\n\r\n        return () => {\r\n          window.removeEventListener('keydown', handleKeyPress);\r\n        };\r\n    }, [handleKeyPress]);\r\n\r\n    const selectMember = (member) => {\r\n        props.setMemberData(member)\r\n        setTimeout(()=>{document.querySelector('#memberEmailInput').focus();}, 5);\r\n\r\n    };\r\n\r\n    return (\r\n        <table className=\"membersTable\">\r\n            <thead>\r\n                <tr>\r\n                    {memberTableColumns.map((column) => {\r\n                        return (\r\n                            <th key={column}>{memberKeys[column] || column}</th>\r\n                        )\r\n                    })}\r\n                </tr>\r\n            </thead>\r\n            <tbody>\r\n                {props.data.map(member => {\r\n                    return (\r\n                        <tr key={member.id} className={[\r\n                            (member.registered ? 'registeredMemberRow' : ''), \r\n                            (props.memberData.id === member.id ? 'selectedMemberRow': '')\r\n                            ].join(' ')} onClick={() => {selectMember(member)}}>\r\n                                {memberTableColumns.map((column) => {\r\n                                    return (\r\n                                        <td key={member.id + column}>\r\n                                            {member[column] ? (formatting[column] ? formatting[column](member[column]) : member[column]) : '-'}\r\n                                        </td>\r\n                                    )\r\n                                })}\r\n                        </tr>\r\n                    )\r\n                })}\r\n            </tbody>\r\n        </table>\r\n    )\r\n}\r\n\r\nexport default MembersTable;","import { useEffect, useState } from 'react';\nimport './styles/App.css';\nimport MailboxCard from './components/MailboxCard';\nimport MemberCard from './components/MemberCard';\nimport MembersTable from './components/MembersTable';\nimport { apiServer } from './configuration';\n\nfunction App() {\n    const [members, setMembers] = useState([]);\n    const [memberData, setMemberData] = useState({});\n    useEffect(() => {\n        console.log('Fetching data...');\n        fetch(apiServer + '/api/users')\n        .then(res => res.json())\n        .then(data => {\n            console.log('Member keys available', Object.keys(data[0]))\n            setMembers(data);\n            setMemberData(data[0]);\n        })\n    }, []);\n\n    return (\n        <div className=\"app\">\n            <div className=\"membersList\">\n                <MembersTable data={members} setMemberData={setMemberData} memberData={memberData} members={members} />\n            </div>\n            <div className=\"controlView\">\n                <div className=\"fixed\">\n                    <h1>Jäsenkortti</h1>\n                    <MemberCard memberData={memberData} />\n                    <h2>Postilaatikko</h2>\n                    <MailboxCard setMembers={setMembers} members={members} setMemberData={setMemberData} memberData={memberData} />\n                </div>\n            </div>\n        </div>\n    );\n}\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './styles/index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n"],"sourceRoot":""}