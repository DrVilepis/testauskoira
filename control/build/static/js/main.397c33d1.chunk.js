(this["webpackJsonptestauskoira-web"]=this["webpackJsonptestauskoira-web"]||[]).push([[0],{187:function(e,t,n){},188:function(e,t,n){},392:function(e,t,n){"use strict";n.r(t);var r=n(19),a=n.n(r),c=n(173),s=n.n(c),i=(n(187),n(42)),o=(n(188),n(182)),l=n(114),m=n.n(l),u=n(174),b=n(175),d=n.p+"static/media/welcomeHeader.6158d06b.svg",j="http://localhost",f={id:"ID",username:"K\xe4ytt\xe4j\xe4nimi",registered:"Postilaatikko",joinedTimestamp:"Liittynyt",createdAt:"Luotu"},h=["id","createdAt","username","registered"];function p(e){var t=new Date(e);return"".concat(t.getDate().toString().padStart(2,"0"),"/").concat((t.getMonth()+1).toString().padStart(2,"0"),"/").concat(t.getFullYear())}var O={createdAt:p,joinedTimestamp:p},v=n(6);function x(e){return e.trim().toLowerCase().replace(/ /g,".").replace(/\xe4/g,"a").replace(/\xf6/g,"o").replace(/[^0-9a-zA-Z.]/g,"")}var k=function(e){var t=Object(r.useState)(""),n=Object(i.a)(t,2),a=n[0],c=n[1],s=Object(r.useState)(""),l=Object(i.a)(s,2),f=l[0],h=l[1],p=Object(r.useState)(!1),O=Object(i.a)(p,2),k=O[0],g=O[1];Object(r.useEffect)((function(){console.log("Fetching welcomeHeader from "+d+"..."),fetch(d).then((function(e){return e.text()})).then((function(e){c(e)}))}),[]),Object(r.useEffect)((function(){g(!1),Object.keys(e.memberData).length>0&&y(e.memberData.username)}),[e.memberData]);var y=function(){var e=Object(u.a)(m.a.mark((function e(t){var n,r,c;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Rendering canvas..."),n=x(t),h(n),r=document.querySelector("canvas"),c=r.getContext("2d"),e.next=7,b.a.fromString(c,a.replace("[name]",n).replace("[size]",n.length>13?"0.7em":"1em"));case 7:e.sent.start();case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),w=function(){window.confirm("My\xf6nn\xe4t k\xe4ytt\xe4j\xe4lle ".concat(e.memberData.username," s\xe4hk\xf6postilaatikon ").concat(f,"@testausserveri.fi ja l\xe4het\xe4t kyseiselle k\xe4ytt\xe4j\xe4lle Discord-viestin t\xe4st\xe4 j\xe4senedusta. Vahvista?"))?document.querySelector("canvas").toBlob((function(t){var n=new FormData;n.append("image",t,f+".png"),n.append("id",e.memberData.id),n.append("mailbox",f),fetch(j+"/api/sendWelcome",{method:"POST",body:n}).then((function(t){console.log(t),200===t.status?(g(!1),function(){console.log(e.members);var t=Object(o.a)(e.members),n=t.findIndex((function(t){return t.id===e.memberData.id}));t[n].registered=f,e.setMembers(t)}()):alert("Tapahtui jokin virhe. \xc4l\xe4 my\xf6nn\xe4 k\xe4ytt\xe4j\xe4lle uutta s\xe4hk\xf6postilaatikkoa. Ota yhteytt\xe4 j\xe4rjestelm\xe4nvalvojaa.")}))})):alert("Peruutettu")};return Object(v.jsxs)("div",{children:[e.memberData.registered?Object(v.jsx)("p",{children:Object(v.jsxs)("b",{children:["J\xe4senell\xe4 on jo s\xe4hk\xf6postilaatikko.\xa0",Object(v.jsx)("a",{href:"#forceShow",onClick:function(e){e.preventDefault(),g(!0),setTimeout((function(){document.querySelector("#memberEmailInput").focus()}),5)},children:"Luo alias"})]})}):Object(v.jsx)("p",{children:"J\xe4senell\xe4 ei ole viel\xe4 s\xe4hk\xf6postilaatikkoa."}),Object(v.jsxs)("div",{style:!e.memberData.registered||k?{}:{display:"none"},children:[Object(v.jsx)("label",{htmlFor:"memberEmailInput",children:"S\xe4hk\xf6postilaatikon nimi"}),Object(v.jsx)("br",{}),Object(v.jsx)("input",{id:"memberEmailInput",value:f,autoFocus:!0,autoComplete:"off",spellCheck:"false",type:"text",onKeyUp:function(e){"Enter"===e.key&&(document.querySelector("#registerBtn").click(),e.preventDefault())},onChange:function(e){return t=e.target.value,void y(t);var t}}),Object(v.jsx)("canvas",{}),Object(v.jsx)("br",{}),Object(v.jsx)("br",{}),Object(v.jsx)("input",{type:"button",id:"registerBtn",value:"Rekister\xf6i ja l\xe4het\xe4 viesti",onClick:function(){return w()}})]})]})};var g=function(e){return Object(v.jsx)("table",{children:Object(v.jsx)("tbody",{children:Object.keys(e.memberData).map((function(t){return Object(v.jsxs)("tr",{className:"memberCard",children:[Object(v.jsx)("td",{children:f[t]||t}),Object(v.jsx)("td",{children:O[t]?O[t](e.memberData[t]):e.memberData[t]})]},t)}))})})};var y=function(e){var t=Object(r.useCallback)((function(t){var n=t.key;if("ArrowUp"===n||"ArrowDown"===n){var r=e.members.findIndex((function(t){return t.id===e.memberData.id}));console.log(e.members),"ArrowUp"===n?(r-=1)<=0&&(r=0):"ArrowDown"===n&&(r+=1)>=e.members.length-1&&(r=e.members.length-1),console.log(r,e.members[r]),e.members[r]&&e.setMemberData(e.members[r])}}),[e]);return Object(r.useEffect)((function(){return window.addEventListener("keydown",t),function(){window.removeEventListener("keydown",t)}}),[t]),Object(v.jsxs)("table",{className:"membersTable",children:[Object(v.jsx)("thead",{children:Object(v.jsx)("tr",{children:h.map((function(e){return Object(v.jsx)("th",{children:f[e]||e},e)}))})}),Object(v.jsx)("tbody",{children:e.data.map((function(t){return Object(v.jsx)("tr",{className:[t.registered?"registeredMemberRow":"",e.memberData.id===t.id?"selectedMemberRow":""].join(" "),onClick:function(){!function(t){e.setMemberData(t),setTimeout((function(){document.querySelector("#memberEmailInput").focus()}),5)}(t)},children:h.map((function(e){return Object(v.jsx)("td",{children:t[e]?O[e]?O[e](t[e]):t[e]:"-"},t.id+e)}))},t.id)}))})]})};var w=function(){var e=Object(r.useState)([]),t=Object(i.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)({}),s=Object(i.a)(c,2),o=s[0],l=s[1];return Object(r.useEffect)((function(){console.log("Fetching data..."),fetch(j+"/api/users").then((function(e){return e.json()})).then((function(e){console.log("Member keys available",Object.keys(e[0])),a(e),l(e[0])}))}),[]),Object(v.jsxs)("div",{className:"app",children:[Object(v.jsx)("div",{className:"membersList",children:Object(v.jsx)(y,{data:n,setMemberData:l,memberData:o,members:n})}),Object(v.jsx)("div",{className:"controlView",children:Object(v.jsxs)("div",{className:"fixed",children:[Object(v.jsx)("h1",{children:"J\xe4senkortti"}),Object(v.jsx)(g,{memberData:o}),Object(v.jsx)("h2",{children:"Postilaatikko"}),Object(v.jsx)(k,{setMembers:a,members:n,setMemberData:l,memberData:o})]})})]})};s.a.render(Object(v.jsx)(a.a.StrictMode,{children:Object(v.jsx)(w,{})}),document.getElementById("root"))}},[[392,1,2]]]);
//# sourceMappingURL=main.397c33d1.chunk.js.map